% Custom LaTeX template for iMessages book
% Optimized for 8.5" x 5.5" format

\documentclass[10pt]{book}

% Page geometry for 8.5" x 5.5" book
\usepackage[
    paperwidth=5.5in,
    paperheight=8.5in,
    margin=0.5in,
    top=0.6in,
    bottom=0.6in
]{geometry}

% Essential packages
\usepackage{fontspec}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}
\usepackage{calc}
\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{hyperref}
\usepackage{parskip}
\usepackage{tikz}

% Float and figure packages
\usepackage{float}
\floatplacement{figure}{H}
\usepackage{caption}
\captionsetup[figure]{
    name=,
    labelsep=none,
    labelformat=empty}

% Basic image handling - no rounded corners for now
\usepackage{adjustbox}
\usepackage{tikz}

% Font configuration - use fonts with better Unicode support
\setmainfont{Arial}
\setmonofont{Courier New}

% Emoji support setup
\usepackage{newunicodechar}
\newfontfamily\emojifont{Symbola}
\InputIfFileExists{templates/emoji-definitions.tex}{}{}

% Message bubble colors
\definecolor{sentmessage}{RGB}{0, 122, 255}
\definecolor{receivedmessage}{RGB}{229, 229, 234}
\definecolor{timestampgray}{RGB}{142, 142, 147}

% Page styling
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[LO,RE]{\leftmark}
\renewcommand{\headrulewidth}{0pt}

% Title formatting
\titleformat{\chapter}[display]
  {\normalfont\huge\bfseries}{\chaptertitlename\ \thechapter}{20pt}{\Huge}
\titleformat{\section}
  {\normalfont\Large\bfseries}{}{0em}{}
\titleformat{\subsection}
  {\normalfont\large\bfseries}{}{0em}{}

% Custom commands for message formatting
\newcommand{\sentmessage}[2]{%
    \begin{flushright}
    \colorbox{sentmessage!20}{%
        \parbox{0.7\textwidth}{%
            \textcolor{black}{#1}%
        }%
    }\\[0.1cm]
    {\small\textcolor{timestampgray}{#2}}
    \end{flushright}
    \vspace{0.2cm}
}

\newcommand{\receivedmessage}[3]{%
    \noindent
    \colorbox{receivedmessage}{%
        \parbox{0.7\textwidth}{%
            \textcolor{black}{#2}%
        }%
    }\\[0.1cm]
    {\small\textcolor{timestampgray}{#3}}\\[0.2cm]
    \vspace{0.2cm}
}

% Image handling with better aspect ratio support
\usepackage{adjustbox}
\usepackage{graphicx}

% Smart image sizing that respects aspect ratios
\newcommand{\messageimage}[2][]{%
    \begin{center}
    \includegraphics[width=0.7\textwidth,height=0.5\textheight,keepaspectratio]{#2}%
    \end{center}
    \vspace{0.3cm}
}

% Alternative command for larger images when needed
\newcommand{\largeimage}[2][]{%
    \begin{center}
    \includegraphics{#2}%
    \end{center}
    \vspace{0.3cm}
}

% Hyperlink styling
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=magenta,
    urlcolor=blue,
    bookmarks=true,
    bookmarksopen=true,
    bookmarksopenlevel=1
}

% Table of contents formatting
\setcounter{tocdepth}{1}
\renewcommand{\contentsname}{Table of Contents}

% Variable definitions will be injected here
%%VARIABLES%%

% Begin document
\begin{document}

% Title page
%%TITLE_PAGE%%

% Copyright page
%%COPYRIGHT_PAGE%%

% Table of contents
\tableofcontents
\newpage

% Main content
%%CONTENT%%

\end{document}